.. sectionauthor:: Артём Светлов <artem.svetlov@nextgis.ru>
.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngw_admin_tasks:

Административные задачи
================================

.. _ngw_create_group:

Создание групп пользователей
----------------------------

Диалог создания новой группы представлен на :numref:`ngweb_admin_controlpanel_usergroup_create_pic`. 
Для открытия этого окна необходимо открыть панель управления 
(см. :numref:`ngweb_admin_control_panel`) и выбрать там: 
:menuselection:`Группы пользователей --> Создать`.

.. figure:: _static/admin_controlpanel_usergroup_create.png
   :name: ngweb_admin_controlpanel_usergroup_create_pic
   :align: center
   :width: 16cm

   Окно создания новой группы.

В диалоге необходимо указать полное и краткое наименование группы и нажать 
кнопку :guilabel:`Создать`. Полное наименование служит в качестве описания. 

.. note:: 
   Название группы должно содержать только цифры и буквы. 


Создание пользователя
---------------------

Диалог создания нового пользователя представлен на :numref:`ngweb_admin_controlpanel_user_create`. 
Для открытия этого окна необходимо открыть панель управления 
(см. :numref:`ngweb_admin_control_panel`) и выбрать там: 
:menuselection:`Пользователи --> Создать`.

В диалоге необходимо указать:

* Полное имя пользователя (например, Иванов Иван Иванович)
* Имя пользователя – логин (например, ivanov)
* Пароль для входа

Выбрать, к какой группе относится пользователь – в списке будут отображены 
имеющиеся группы. Если необходимой группы в списке нет, то ее необходимо создать 
(см. :ref:`ngw_create_group`).

Далее необходимо нажать кнопку :guilabel:`Создать`.

.. figure:: _static/admin_controlpanel_user_create.png
   :name: ngweb_admin_controlpanel_user_create
   :align: center
   :width: 16cm

   Окно создания пользователя.


.. _ngw_access_rights:
    
Настройка прав доступа
----------------------

NextGIS Web строится на ресурсном подходе - каждый компонент системы (слой, 
группа, сервис) является ресурсом. NextGIS Web обладает расширенными настройками 
прав доступа к ресурсам.

Права доступа можно назначить как при создании ресурса (см. :ref:`ngw_create_layers`), 
так и при его изменении (см. :ref:`ngw_change_layers`). Для этого в диалоге 
создания/изменения ресурс необходимо перейти на вкладку 
"Права доступа" (см. :numref:`ngweb_access_rights_tab`).

.. figure:: _static/access_rights_tab.png
   :name: ngweb_access_rights_tab
   :align: center
   :width: 10cm
   
   Вкладка настроек прав доступа.

В данной вкладке можно назначать, отменять или изменять права доступа. Для одного
ресурса могут быть назначены различные права доступа пользователей и/или групп.
Диалог настроек правил доступа представлен на рис. :numref:`ngweb_access_rights_dialog`.

.. figure:: _static/access_rights_dialog.png
   :name: ngweb_access_rights_dialog
   :align: center
   :width: 10cm
   
   Диалог настроек правил доступа.

Диалог включает в себя следующие элементы:
    
* Действие
* Субъект
* Право
* Ресурс
* Распространять

**Действие** определяет типы правила - запрещающее или разрешающее.

.. note:: По-умолчанию все запрещено.

**Субъект** - пользователь или группа, на которых распространяется правило.

**Право** - определяет разрешенные или запрещенные действия с ресурсом. Существуют 
следующие виды прав: 

* Все ресурсы: Все права
* Ресурс: Все права
* Ресурс: Управление дочерними ресурсами
* Ресурс: Управление правами доступа
* Ресурс: Чтение
* Ресурс: Создание
* Ресурс: Изменение
* Ресурс: Удаление
* Сервис: Все права
* Сервис: Подключение
* Сервис: Настройка
* Структура данных: Все права
* Структура данных: Запись
* Структура данных: Чтение
* Соединение: Все права
* Соединение: Запись параметров соединения
* Соединение: Чтение параметров соединения
* Соединение: Использование соединения
* Веб-карта: Все права
* Веб-карта: Просмотр
* Данные: Все права
* Данные: Запись
* Данные: Чтение
* Метаданные: Все права
* Метаданные: Запись
* Метаданные: Чтение

**Ресурс** - на какие ресурсы распространять. Это актуально для группы ресурсов, 
где необходимо назначить права определенным типам ресурсов. Если нет необходимости 
в выборе типов ресурсов или все ресурсы в группе одинаковые, то ставиться "Все 
ресурсы".

Чекбокс "**Распространять**" определяет, распространять ли правило на ресурсы в 
подгруппы или нет.

Права могут назначаться ресурсам, даже которым не соответствуют явно, например,
право "Веб-карта: Просмотр" может быть назначено группе ресурсов, и, если включен
переключатель "Распространять", то право будет распространяться на все веб-карты
в данной группе и всех подгруппах.

Рассмотрим права подробнее.

**Все ресурсы: Все права** - разрешает или запрещает любые действия с ресурсами.

**Ресурс: Все права** - разрешает или запрещает любые действия с ресурсами, за
исключением групп ресурсов.

**Ресурс: Управление дочерними ресурсами** - разрешает или запрещает изменение 
настроек дочерних ресурсов. 
 
**Ресурс: Управление правами доступа** - разрешает или запрещает управлять правами
доступа к ресурсу.

**Ресурс: Чтение** - разрешает или запрещает чтение ресурсов.

**Ресурс: Создание** - разрешает или запрещает создание ресурсов.

**Ресурс: Изменение** - разрешает или запрещает модифицировать ресурсы.

**Ресурс: Удаление** - разрешает или запрещает удалять ресурсы.

**Сервис: Все права** - разрешает или запрещает любые действия с сервисом.

**Сервис: Подключение** - разрешает или запрещает выполнять подключения к сервису.

**Сервис: Настройка** - разрешает или запрещает изменять настройки сервиса.

**Структура данных: Все права** - разрешает или запрещает любые действия со 
структурой данных.

**Структура данных: Запись** - разрешает или запрещает изменять структуру данных.

**Структура данных: Чтение** - разрешает или запрещает чтение структуры данных.

**Соединение: Все права** - разрешает или запрещает любые действия с соединениями.

**Соединение: Запись параметров соединения** - разрешает или запрещает 
модифицировать соединения.

**Соединение: Чтение параметров соединения** - разрешает или запрещает чтение 
параметров соединения.

**Соединение: Использование соединения** - разрешает или запрещает использовать 
соединение (будут ли доступны пользователю слои или данные из соединения).

**Веб-карта: Все права** - разрешает или запрещает любые действия над веб-картой.

**Веб-карта: Просмотр** - разрешает или запрещает просмотр веб-карты.

**Данные: Все права** - разрешает или запрещает любые действия над данными.

**Данные: Запись** - разрешает или запрещает модификацию данных.

**Данные: Чтение** - разрешает или запрещает чтение данных.

**Метаданные: Все права** - разрешает или запрещает любые действия над 
метаданными.

**Метаданные: Запись** - разрешает или запрещает модифицировать метаданные.

**Метаданные: Чтение** - разрешает или запрещает читать метаданные.

При назначении прав на тот или иной ресурс следует учитывать права на составляющие 
его ресурсы. Например, для предоставления доступа к WMS сервису необходимо дать 
следующие права:
    
* Сервис: Подключение - разрешение на само подключение.
* Ресурс: Чтение - разрешение на все ресурсы (векторные и растровые слои), 
  опубликованные в WMS сервисе.
* Структура данных: Чтение - разрешение на все ресурсы (векторные и растровые слои),
  опубликованные в WMS сервисе.
* Данные: Чтение - разрешение на все ресурсы (векторные и растровые слои),
  опубликованные в WMS сервисе.

Если у вас сложная система с несколькими отдельными картами, и с ней должны 
работать разные пользователи, то можно создать группы пользователей. Для групп 
можно настраивать права доступа по отдельности.


Примеры настроек прав доступа
-----------------------------

Дать гостю права на просмотр карты
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note:: 
	Гости будут иметь возможность видеть админку и ходить по всем папкам, кроме специально закрытых.

.. figure:: _static/access_rights_group_for_quest_0.png
   :name: ngweb_access_rights_tab_0_pic
   :align: center
   :width: 16cm

   Задать в свойствах корневой группы ресурсов.


.. figure:: _static/access_rights_group_for_quest_webmaps.png
   :name: ngweb_access_rights_tab_1_pic
   :align: center
   :width: 16cm

   Задать в свойствах группы ресурсов с веб-картами.


.. figure:: _static/access_rights_group_for_quest_geodata.png
   :name: ngweb_access_rights_tab_2_pic
   :align: center
   :width: 16cm

   Задать в свойствах группы ресурсов с геоданными.


Дать одному пользователю права на одну группу ресурсов
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


.. figure:: _static/access_rights_group_for_user_1.png
   :name: ngweb_access_rights_tab_3_pic
   :align: center
   :width: 16cm

   Задать в свойствах группы ресурсов.



.. figure:: _static/access_rights_group_for_user_2.png
   :name: ngweb_access_rights_tab_4_pic
   :align: center
   :width: 16cm

   Задать в свойствах корневой группы ресурсов.


Дать группе пользователей право на ввод данных через мобильное приложение
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Создайте отдельную группу пользователей (в примере - "Openstreetmap users"), и отдельную группу ресурсов.  


.. figure:: _static/access_rights_group_for_mobile_import_1.png
   :name: ngweb_access_rights_tab_mobile_import_1_pic
   :align: center
   :width: 16cm

   Задать в свойствах группы ресурсов.



.. figure:: _static/access_rights_group_for_mobile_import_2.png
   :name: ngweb_access_rights_tab_mobile_import_2_pic
   :align: center
   :width: 16cm

   Задать в свойствах корневой группы ресурсов.

.. _ngw_change_password:

Изменение пароля пользователя
-----------------------------

Для смены пароля пользователя можно воспользоваться веб интерфейсом.
Также существует возможность изменить пароль пользователя из командной
строки:

.. note:: Указание нового пароля пользователя в командной строке потенциально не безопасно.

.. code:: bash

  env/bin/nextgisweb --config config.ini change_password user password
  env/bin/nextgisweb --config config.ini change_password user password
