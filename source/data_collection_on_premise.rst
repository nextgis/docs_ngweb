.. sectionauthor:: Роман Гайнуллов <roman.gainullov@nextgis.ru>

.. role:: underline
    :class: underline

Сбор геоданных на своем сервере
============================

.. _intro:

Введение
--------

.. note:: 
	**Условие**: Данное руководство предполагает наличие у пользователя приобретенной лицензии NextGIS Web для `своего сервера <https://nextgis.ru/pricing/>`_.

**Программное обеспечение и компоненты.**

Редакция **Standard**:

* `NextGIS Formbuilder <https://nextgis.ru/nextgis-formbuilder>`_ - настольное приложение для создания форм при подготовке к сбору геоданных.
* `NextGIS Mobile <https://nextgis.ru/nextgis-mobile/>`_ (NGM) - мобильная ГИС для ОС Android.
* `NextGIS Web <https://nextgis.ru/nextgis-web/>`_ (NGW) - серверная Веб ГИС для синхронизации полученных в полевых условиях пространственных данных, их дальнейшего хранения, обработки, визуализации и анализа.
* `NextGIS ID on-premise <https://docs.nextgis.ru/docs_ngid/source/toc.html>`_ (NGIDOP) - сервер авторизации пользователей для управления доступом к процессу сбора геоданных.
* `NextGIS QGIS <https://nextgis.ru/nextgis-qgis/>`_ - полнофункциональная настольная ГИС для создания и редактирования данных, производства карт, выполнения аналитических операций.
* `NextGIS Rosreestr Tools <https://nextgis.ru/rosreestr-tools/>`_ - дополнительный модуль в составе NextGIS QGIS для работы с кадастровыми данными и ПКК.

Редакция **Extended**. Standard +:

* `NextGIS Collector <https://nextgis.ru/nextgis-collector/>`_ (NGC)- специализированное мобильное приложение для сбора геоданных в полевых условиях.
* NextGIS Collector Hub - дополнительный веб-модуль для взаимодействия между NextGIS Web и NextGIS Collector.
* NextGIS Tracking Hub - дополнительный веб-модуль для передачи данных между NextGIS Web и мобильными приложениями для записи треков (Tracker, NGM, NGC).

**Роли**: Системный администратор, администратор проекта и сборщики данных.

**Системный администратор** занимается разворачиванием и администрированием системы на сервере организации. **Администратор проекта** отвечает за настройку процесса сбора данных. **Сборщики данных** используют только приложение NextGIS Collector.

.. _admin_checklist:

Чеклист по ролям
-------
**Системный администратор**

1. Развернуты NGW, NGIDOP, Collector Hub и Tracking Hub на своем сервере.
2. Убедиться в наличии настроек NGIDOP (Параметры конфигурации предоставляются по запросу): разделы `Приложения OAuth <https://docs.nextgis.ru/docs_ngid/source/ngidop.html#oauth>`_ и `NextGIS ID on-premise <https://docs.nextgis.ru/docs_ngid/source/ngidop.html#nextgis-id-on-premise>`_ - настройки collector_hub в соответствии с адресом, где он был развернут - **без этого сбор данных будет невозможен**. 
3. Завести пользователей для сборщиков данных в Разделе `Команда <https://docs.nextgis.ru/docs_ngid/source/ngidop.html#ngidop-teams>`_ NGIDOP

Более полное и развернутое описание есть в `документе <https://docs.google.com/document/d/1fAfL-DqwUKeGQkNHWPRE7sU4N4VRMc4z7xWFShTOCq4/edit?usp=sharing>`_.

**Администратор проекта**

4. Перейти в NextGIS Web. Через `Панель управления <https://docs.nextgis.ru/docs_ngcom/source/collector.html#collector-add-members>`_ создать список участников сбора данных с именами пользователей, аналогичными пользователям в Команде на предыдущем шаге. В дальнейшем при настройке всех проектов сбора данных пользователи (сборщики) будут браться из этого списка.
5. Создать точечные векторные слои в NextGIS Web, в которые данные будут собираться. Это можно сделать как из `интерфейса <https://docs.nextgis.ru/docs_ngweb/source/layers.html#ngw-create-vector-layer>`_, так и с помощью `NextGIS Formbuilder <https://nextgis.ru/nextgis-formbuilder>`_, создав специальную форму для сбора данных. Более подробный процесс создания форм описан в `документации <https://docs.nextgis.ru/docs_formbuilder/source/toc.html>`_. Заметим, что здесь нужно будет поменять `endpoint авторизации <https://docs.nextgis.ru/docs_formbuilder/source/gui.html#ngidop>`_ с облака (my.nextgis.com) на сервер авторизации NextGIS ID on-premise, развернутый внутри вашей организации.

После этого можно начинать настраивать конкретные проекты для дальнейшего сбора данных. Для этого в NGW существует специальный ресурс - **Проект Collector** (проект сбора данных). Потребуется указать название нового ресурса (его будут видеть сборщики данных в приложении NextGIS Collector и администратор в интерфейсе NGW), по желанию описание и метаданные.

6. Важными частями каждого проекта сбора данных являются вкладки **Проект, Элементы, Участники**. На вкладке **Проект** администратор указывает имя пользователя NGW, от лица которого будет производиться запись собранных данных в базу. По умолчанию это может быть *administrator*, полученный после установки NGW на сервере. Однако мы рекомендуем `создать <https://docs.nextgis.ru/docs_ngweb/source/admin_tasks.html#ngw-create-user>`_ специального пользователя для этих целей. На вкладке **Элементы** нужно добавить слои, в которые данные будут собираться, и подложки для более комфортного процесса их сбора. На вкладке **Участники** из списка необходимо выбрать пользователей (сборщиков данных), которые будут иметь доступ к сбору данных в настраиваемом проекте (из п.4). Сохранить проект со всеми настройками.

**Сборщики данных**

7. Работа сборщиков в мобильном приложении `NextGIS Collector <https://docs.nextgis.ru/docs_collector/source/toc.html>`_. В первую очередь (аналогично Formbuilder) сборщик данных должен поменять `сервер авторизации <https://docs.nextgis.ru/docs_collector/source/auth.html#ngidop>`_ на NGIDOP. Далее работа происходит стандартная работа сборщика в поле - авторизация под выданными администратором логином и паролем (из раздела Команда) и сбор данных. Основные моменты по работе с приложением описаны в `документации <https://docs.nextgis.ru/docs_collector/source/toc.html>`_.

P.S. Дополнительно можно ознакомиться с процессом сбора данных `для облака nextgis.com <https://docs.nextgis.ru/docs_ngcom/source/collector.html>`_.
